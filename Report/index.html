<!doctype html>
<html>
<head>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css" />
<script src="https://kendo.cdn.telerik.com/2017.2.621/js/jquery.min.js"></script> 
<script src="https://kendo.cdn.telerik.com/2017.2.621/js/jszip.min.js"></script>
<script src="https://kendo.cdn.telerik.com/2017.2.621/js/kendo.all.min.js"></script> 
<title>Data Exploration Report</title>
</head>

<body>
<div id="html-2-pdfwrapper">
    <div id="row">
    <center><h1>Data Exploration Report</h1></center>  <!-- document title --><center>
    <b>Results by TwoRavens: </b> <a href="http://2ra.vn/">Project Link</a></center>
    <!-- Date(s) -->
    <center><p id="date"></p></center>
    <script> var today = new Date(); document.getElementById("date").innerHTML = Date(); </script>
    <button onclick="generate()" class="noExport">Generate PDF</button>
    </div>
    <div id="row" class="noExport" > <!--Using noExport class will disable the export of the div to pdf-->
    <h1 id="table_of_contents" >Table of Content</h1>
    <center><h4 id="toc"></h4></center>    
    </div>
    <center><h4 id="headers"></h4></center>
</div>

<script>
var content = [];
toc = [];
d3.json("/PreprocessedFiles/fearonLaitin.json", function(error, data) {
    
// Make some strings to include in our output.
var tableHeader1 = "<table id='table'><tr>";
var tableContent1 = "";
var tableFooter1 = "</table><br>";
var tableHeader2 = "<table id='table'><tr>";
var tableContent2 = "";
var tableFooter2 = "</table><br>";
var tableHeader3 = "<table id='table'><tr>";
var tableContent3 = "</tr>";
var tableFooter3 = "</table></section></div>";

nonNumeric = ['numchar', 'nature', 'binary', 'interval','time'];
numeric1 = ['valid', 'invalid', 'median','mean','mode','max','min'];
numeric2 = ['uniques','freqmode','fewest','mid','freqmid','sd','herfindahl'];
i = 1;
    
toc += "<ul id ='hlist'>";
for (let variable in data['variables']) 
{
    varData = data['variables'][variable];
    toc += "<button class = 'buttonhlist'><li><a href='#" + variable + "'>" + capitalizeFirstLetter(variable) + "</a></li></button>"
}
toc += "</ul>";    
document.getElementById("toc").innerHTML = toc;

// First Table header
for (var y = 0; y < numeric1.length; y++) {
    tableHeader1 += "<th>"+numeric1[y]+"</th>"
}
tableHeader1 += "</tr><tr>"; 

// Second Table header 
for (var y = 0; y < numeric2.length; y++) {
    tableHeader2 += "<th>"+numeric2[y]+"</th>"
}
tableHeader2 += "</tr><tr>"; 

// Third Table header 
for (var y = 0; y < nonNumeric.length; y++) {
    tableHeader3 += "<th>"+nonNumeric[y]+"</th>"
}    
tableHeader3 += "</tr><tr>"; 
 
for (let variable in data['variables']) 
{   
    varData = data['variables'][variable];
    var containerModule = "<div id='modal' style='text-transform: capitalize'><header><h1 id='" + variable+ "'><b>" +i + ". "+variable+"</b></h1></header><section>"  
    
    for (var y = 0; y < numeric1.length; y++) {
    tableContent1 += "<td>" + varData[numeric1[y]] + "</td>"
    }
    tableContent1 += "</tr>"; 
    
    for (var y = 0; y < numeric2.length; y++) {
    tableContent2 += "<td>" + varData[numeric2[y]] + "</td>"
    }
    tableContent2 += "</tr>";
    
    for (var y = 0; y < nonNumeric.length; y++) {
    tableContent3 += "<td>" + varData[nonNumeric[y]] + "</td>"
    }
    tableContent3 += "</tr>";    
    
    content +=  containerModule;
    var label = (varData.labl != "")? content += "<h2>Description</h2><br>" + "<h3>" + varData.labl + "</h3><br>" : null; 
    
    content += "<h2>Distribution Plots</h2><br>" + "<div class='main_block'><div class='inner_block'><img  src=img/" + variable + "CDF.png" + "></div>" + "<div class='inner_block'><img  src=img/" + variable + "PDF.png" + "></div></div>"+ "<h2>Numeric Summary</h2><br>" ;
    
    content += tableHeader1 + tableContent1 + tableFooter1 + tableHeader2 + tableContent2 + tableFooter2 + "<h2>Non-Numeric Summary</h2><br>" + tableHeader3 + tableContent3 + tableFooter3;
    
    document.getElementById("headers").innerHTML = content;
    var tableContent1 = "";
    var tableContent2 = "";
    var tableContent3 = "</tr>";
    i++; 
}
})   

// code for Kendo API to export html to PDF
kendo.pdf.defineFont({
            "Montserrat-Regular" : "../../fonts/montserrat/Montserrat-Regular.ttf",
            "Montserrat-Light" : "../../fonts/montserrat/Montserrat-Light.ttf",
            "Montserrat-SemiBold" : "../../fonts/montserrat/Montserrat-SemiBold.ttf",
            "Montserrat-Medium" : "../../fonts/montserrat/Montserrat-Medium.ttf",
            "DejaVu Sans":
             "http://cdn.kendostatic.com/2017.2.621/styles/fonts/DejaVu/DejaVuSans.ttf"
        }); 
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}  
generate = function ExportPdf(){ 
kendo.drawing
    .drawDOM("#html-2-pdfwrapper", 
    { 
        forcePageBreak: "#modal", // enabling forcePageBreak would enforce a page break after each modal div   
		paperSize:"A4",
        scale:0.5,
        margin: { left: "0cm", top: "1cm", right: "0cm", bottom: "1cm"  },
    })
        .then(function(group){
        kendo.drawing.pdf.saveAs(group, "TwoRavens_Data_Exploration_Report.pdf")
    });
} 
</script>
    
</body>
</html>